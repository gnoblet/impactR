---
title: "Some workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Some workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Why?

This document aims at providing the workflow that may arise from and through the use of `impactR`. Let's load the package.
```{r initiate-impactr}
# If you haven't done so 
# devtools::install_github("impactR)
library(impactR)
```



Below, let's use the 'airports' dataset from package `nycflights13`
```{r initiate-data}
# Load dataset in environment
data(data)

# Show the first lines and types of airports' tibble
data <- data |> tibble::as_tibble()
data
```

Most of `impactR`'s functions are written with the assumption that the provided data may be coerced to a tibble, since it extensively use the tidyverse.

Let's sat we have a survey sheet composed as: 
```{r initiate-survey}
data(survey)
survey <- survey |> tibble::as_tibble(survey)
```

First thing to do with 'survey' as it will be used elsewhere: separate the type column.
```{r split-survey}
# All are already defaults apart from 'col_to_split'
survey <- survey |>  
  split_survey(
    col_to_split = "type",
    into = c("type", "list_name"),
    sep = " ",
    fill = "right")
```



## Monitor data collection

### Check for outliers

In order to check for outliers, there's a main one that you can use, that will check for two types of outliers: Deviation from the mean and IQR deviation.

```{r monitor-outliers1}
# Helper to get numeric columns
numeric_cols(data) # Get all numeric columns : it includes for example numeric enumerator ids or gps locations
numeric_cols(data, survey) # Check for numeric columns using the survey sheet.

# Get IQR outliers (1.5 default rule)
outliers_iqr(data, col = alt,times = 1.5,  id_col = faa) # id_col is usually "uuid" with Kobo

# Get standard deviation outliers
outliers_sd(airports, alt, times = 3, id_col = faa)

# Create the full log of outliers of all numeri columns
log_outliers <- make_log_outlier(airports, survey, id_col = faa, tzone)
log_outliers
```


### Check for others

```{r monitor-others}
# Obtenir les autres 
other_cols <- other_cols(data, "autre_", id_col = uuid)
other_cols

# Obtenir les autres parents
other_parent_cols(data, other_cols, "autre_", id_col = uuid)

# Fabriquer le journal de nettoyage des "autres"
log_others <- make_log_other(data, survey, "autre_", uuid, i_enum_id, i_zad) 
log_others

