---
title: "Some workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Some workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Pourquoi

Cette vignette a pour but d'expliciter l'usage d'`impactR` et la manière dont il est possible de l'utiliser dans le cadre d'un suivi de collecte de données et du nettoyage. Commençons par charger le package.
```{r initiate-impactr}
# Si vous n'avez pas encore installé le package
# devtools::install_github("impactR)
library(impactR)
```



Ci-dessus, on peut charger des données exemple collectées, des feuilles 'survey' et 'choix' de Kobo.
```{r initiate-airports}
#install.packages("nycflights13")
library(nycflights13)

# Load dataset in environment
data(airports)

# Show the first lines and types of airports' tibble
airports
```

La plupart des fonctions de `impactR` sont écrites en supposant que les données fournies peuvent être converties en tibble, puisqu'elles utilisent largement le tidyverse.

Supposons que nous ayons une feuille 'survey' composée comme suit : 
```{r initiate-survey}
survey <- tibble::tibble(
  type = c("select_one faa_list", "select_one name_list", "decimal", "decimal", "integer", "gps", "select_one destination_list", "select_one tzone_list"),
  name = colnames(airports),
  label = colnames(airports)
)
```

La première chose à faire avec l'objet 'survey', car il sera utilisé ailleurs : il faut séparer en deux la colonne 'type'.
```{r split-survey}
# Miseà part l'argument 'col_to_split' (la colonne à séparer), les autres paramètres sont les paramètres par défaut
survey <- survey |>  
  split_survey(
    col_to_split = "type",
    into = c("type", "list_name"),
    sep = " ",
    fill = "right")
```



## Contrôle de la qualité des données

### Vérification les valeurs aberrantes

Afin de pouvoir obtenir les valeurs dites aberrantes (pour les variables numériques), vous pouvez utiliser la fonction `make_log_outlier` qui permet d'obtenir deux types de valeurs aberrantes : l'écart par rapport à la moyenne et l'écart interquartile

```{r monitor-outliers1}
# Utilitaire pour obtenir toutes les variables numériques
numeric_cols(airports) #  Obtenir toutes les colonnes numériques : cela inclut par exemple les identifiants numériques des énumérateurs ou les points GPS.
numeric_cols(airports, survey) # Obtenir toutes les colonnes numériques en utilisant la feuille 'survey' de l'outil Kobo (uniquement les calculate, integer, etc.)

# Valeurs aberrantes interquartle (règle des 1,5 fois par défaut)
outliers_iqr(airports, col = alt,times = 1.5,  id_col = faa) # La colonne d'identifiant 'id_col' est habituellement "uuid" avec Kobo

# Valeurs aberrantes à la moyenne
outliers_sd(airports, alt, times = 3, id_col = faa)

# Fabriquer le journal de nettoyage entier pour toutes les variables numériques (en prenant en compte l'outil Kobo)
make_log_outlier(airports, survey, id_col = faa, tzone)
```


